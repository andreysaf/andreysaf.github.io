(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[699],{9260:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/how-to-migrate-nextjs-react-ga4",function(){return n(2538)}])},2538:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var r=n(5893),a=n(9008),o=n.n(a),i=(n(7294),n(6979)),s=n(1669),l=n(7345),c=n(9489),d=n(6803),h=n(4418),g=n(9564),u=n(1941),p=n(3838),f=n(7471),x=n(5059),y=n(1639),m=n(3179),j=n(5425),w=n(5432),v=(0,x.G)((function(e,t){const n=(0,y.mq)("Code",e),{className:a,...o}=(0,m.Lr)(e);return(0,r.jsx)(j.m.code,{ref:t,className:(0,w.cx)("chakra-code",e.className),...o,__css:{display:"inline-block",...n}})}));v.displayName="Code";var A=n(63),G=n(1127),b=n(6151),k=function(){return(0,r.jsxs)(A.Z,{children:[(0,r.jsxs)(o(),{children:[(0,r.jsx)("title",{children:"How to Migrate Next.js or React Project Using react-ga to GA4?"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"}),(0,r.jsx)("link",{rel:"canonical",href:"https://andreysafonov.com/blog/how-to-migrate-nextjs-react-ga4"}),(0,r.jsx)("meta",{name:"Description",content:"In this blog we will go over how to transition your Next.js web app to GA4 using react-ga4."}),(0,r.jsx)("meta",{name:"author",content:"Andrey Safonov"})]}),(0,r.jsx)(G.Z,{}),(0,r.jsx)(i.W,{maxW:"5xl",p:"12",children:(0,r.jsxs)(s.g,{paddingTop:"40px",spacing:"2",alignItems:"flex-start",children:[(0,r.jsxs)(l.a,{mb:4,children:[(0,r.jsx)(c.g,{children:(0,r.jsx)(d.A,{href:"/",children:"Home"})}),(0,r.jsx)(c.g,{children:(0,r.jsx)(d.A,{href:"/blog",children:"Blog"})}),(0,r.jsx)(c.g,{children:(0,r.jsx)(d.A,{href:"#",children:"Migrate Next.js Project using react-ga to GA4"})})]}),(0,r.jsx)(h.X,{as:"h1",children:"How to Migrate Next.js or React Project using react-ga to GA4?"}),(0,r.jsx)(g.x,{as:"p",fontSize:"sm",children:"May 27th, 2023"}),(0,r.jsx)(u.E,{objectFit:"cover",src:"/blog/next-js-ga4.jpeg",alt:"Next.js logo and Google Analytics logo from Wiki Commons",padding:10}),(0,r.jsxs)(g.x,{as:"p",fontSize:"lg",children:["In this blog, we will go over how you can migrate from Google Universal Analytics to Google Analytics 4 in your Next.js web app if you are using ",(0,r.jsx)(p.r,{href:"https://www.npmjs.com/package/react-ga",style:{textDecoration:"underline"},children:"react-ga"}),". Google UA will stop working on July 1st, 2023 so it is a good idea to do it beforehand. ",(0,r.jsx)(p.r,{href:"https://www.npmjs.com/package/react-ga",style:{textDecoration:"underline"},children:"react-ga"})," is a popular package that has been used to make Google Analytics a breeze in React apps. ",(0,r.jsx)(p.r,{href:"https://www.npmjs.com/package/react-ga4",style:{textDecoration:"underline"},children:"react-ga4"})," adds support for GA4. Now it is worth mentioning that react-ga4 was not written by the same creators as react-ga. There is also a license change from react-ga to react-ga4. react-ga is distributed under Apache 2.0, whereas react-ga4 is under MIT."]}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"In this guide, you will learn:"}),(0,r.jsxs)(f.QI,{pt:3,fontSize:"lg",children:[(0,r.jsx)(f.HC,{children:(0,r.jsx)(p.r,{href:"#get-ga4-property",style:{textDecoration:"underline"},children:"How to get your GA4 property"})}),(0,r.jsx)(f.HC,{children:(0,r.jsx)(p.r,{href:"#setup-reactga4",style:{textDecoration:"underline"},children:"How to setup react-ga4"})}),(0,r.jsx)(f.HC,{children:(0,r.jsx)(p.r,{href:"#install-reactga4",style:{textDecoration:"underline"},children:"How to switch react-ga to react-ga4"})}),(0,r.jsx)(f.HC,{children:(0,r.jsx)(p.r,{href:"#add-ga4-property",style:{textDecoration:"underline"},children:"How to add GA4 property to react-ga4"})}),(0,r.jsx)(f.HC,{children:(0,r.jsx)(p.r,{href:"#receive-ga4-data",style:{textDecoration:"underline"},children:"How to start receiving data in Google Analytics"})})]}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"I will assume that you already have the Next.js app and react-ga configured. This guide is also applicable to a React app as well."}),(0,r.jsx)(h.X,{as:"h3",size:"md",pt:5,children:(0,r.jsx)("a",{id:"get-ga4-property",children:"Get GA4 Property"})}),(0,r.jsxs)(g.x,{as:"p",fontSize:"lg",children:["To get your GA4 property, you can do so by logging into your ",(0,r.jsx)(p.r,{href:"https://analytics.google.com/analytics/web/",style:{textDecoration:"underline"},children:"Google Analytics"}),". If you have not set up your GA4, you will have a whole bunch of warnings, banners, and popups telling you to do so. You can follow any of them to get to the setup assistant. If for some reason you are not getting any of the popups, you can follow the official ",(0,r.jsx)(p.r,{href:"https://support.google.com/analytics/answer/9744165",style:{textDecoration:"underline"},children:"guide by Google"}),"."]}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"You will need a measurement ID that will look like this: G-XXXXXXXXXX. Save it, you will need it for the next step."}),(0,r.jsx)(h.X,{as:"h3",size:"md",pt:5,children:(0,r.jsx)("a",{id:"setup-reactga4",children:"Setup react-ga4 in your Next.js project"})}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"If you have not set up react-ga or react-ga4, you can follow along here. First, go ahead and install react-ga4."}),(0,r.jsx)(v,{children:"npm i react-ga4"}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"Add a new file called `components/googleAnalytics.js` in your project and paste the following:"}),(0,r.jsx)(v,{display:"block",whiteSpace:"pre",width:"100%",children:'import ReactGA from "react-ga4"\n \nexport const initGA = () => {\n  ReactGA.initialize("G-XXXXXXX")\n}\n  \nexport const logPageView = () => {\n  ReactGA.send({ hitType: \'pageview\', \n  page: window.location.pathname, \n  title: window.document.title \n})\n}'}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"Then create another file called `components/layout.js` in your project and paste the following:"}),(0,r.jsx)(v,{display:"block",whiteSpace:"pre",width:"100%",children:'import React, { useEffect } \nfrom "react";\nimport { initGA, logPageView } \nfrom "./googleAnalytics.js";\n\nconst Layout = (props) => {\n\nuseEffect(() => {\n  if (!window.GA_INITIALIZED) {\n    initGA();\n    window.GA_INITIALIZED = true;\n  }\n  logPageView();\n});\n\nreturn (\n  <div>{props.children}</div>\n);\n\n};\n\nexport default Layout;'}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"Then you can wrap any page in the layout component to track it."}),(0,r.jsx)(v,{display:"block",whiteSpace:"pre",width:"100%",children:"import Layout from '../../components/layout';\n\nexport const myPage = () => {\n  return {\n    <Layout>\n      <div>Hello World<div/>\n    </Layout>\n  }\n}\n              "}),(0,r.jsx)(h.X,{as:"h3",size:"md",pt:5,children:(0,r.jsx)("a",{id:"install-reactga4",children:"Remove React-GA and Install React-GA4"})}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"Run the following command to remove react-ga:"}),(0,r.jsx)(v,{children:"npm uninstall react-ga"}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"Then install react-ga4:"}),(0,r.jsx)(v,{children:"npm install react-ga4"}),(0,r.jsx)(h.X,{as:"h3",size:"md",pt:5,children:(0,r.jsx)("a",{id:"add-ga4-property",children:"Add Your GA4 Property to React-GA4"})}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"Wherever you have initialized your react-ga, open that file. For me, I created a separate file called googleAnalytics.js. Inside of the file swap the UA property in initialize call to the new measurement ID."}),(0,r.jsx)(v,{children:'ReactGA.initialize("G-XXXXXXX")'}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"Then wherever you track the page view event, remove set and pageview calls and replace them with send function."}),(0,r.jsx)(v,{children:"ReactGA.send({ hitType: 'pageview', page: window.location.pathname, title: window.document.title })"}),(0,r.jsx)(h.X,{as:"h3",size:"md",pt:5,children:(0,r.jsx)("a",{id:"receive-ga4-data",children:"Start Receiving Data in Google Analytics"})}),(0,r.jsxs)(g.x,{as:"p",fontSize:"lg",children:["At this point, if you refresh the page a couple of times, you should start seeing data flow in ",(0,r.jsx)(p.r,{href:"https://analytics.google.com/analytics/web/",style:{textDecoration:"underline"},children:"Google Analytics"}),"."]}),(0,r.jsx)(g.x,{as:"p",fontSize:"lg",children:"Now you also want to ensure that GA scripts are allowed. I was using Brave which automatically blocks GA scripts and did not see the data reflected until I turned off the shields."}),(0,r.jsx)(h.X,{as:"h3",size:"md",pt:5,children:"Next Steps"}),(0,r.jsxs)(g.x,{as:"p",fontSize:"lg",children:["I hope you enjoyed this post. If you have any questions, reach out on my ",(0,r.jsx)(p.r,{href:"https://www.linkedin.com/in/andreysaf/",style:{textDecoration:"underline"},children:"LinkedIn"}),"."]})]})}),(0,r.jsx)(b.Z,{})]})}},5721:function(e,t,n){"use strict";n.d(t,{d:function(){return o},z:function(){return i}});var r=n(6245),a=n(7294);function o(e){const{loading:t,src:n,srcSet:o,onLoad:i,onError:s,crossOrigin:l,sizes:c,ignoreFallback:d}=e,[h,g]=(0,a.useState)("pending");(0,a.useEffect)((()=>{g(n?"loading":"pending")}),[n]);const u=(0,a.useRef)(),p=(0,a.useCallback)((()=>{if(!n)return;f();const e=new Image;e.src=n,l&&(e.crossOrigin=l),o&&(e.srcset=o),c&&(e.sizes=c),t&&(e.loading=t),e.onload=e=>{f(),g("loaded"),null==i||i(e)},e.onerror=e=>{f(),g("failed"),null==s||s(e)},u.current=e}),[n,l,o,c,i,s,t]),f=()=>{u.current&&(u.current.onload=null,u.current.onerror=null,u.current=null)};return(0,r.G)((()=>{if(!d)return"loading"===h&&p(),()=>{f()}}),[h,p,d]),d?"loaded":h}var i=(e,t)=>"loaded"!==e&&"beforeLoadOrError"===t||"failed"===e&&"onError"===t},1941:function(e,t,n){"use strict";n.d(t,{E:function(){return c}});var r=n(5059),a=n(5893),o=(0,r.G)((function(e,t){const{htmlWidth:n,htmlHeight:r,alt:o,...i}=e;return(0,a.jsx)("img",{width:n,height:r,ref:t,alt:o,...i})}));o.displayName="NativeImage";var i=n(5721),s=n(5425);function l(e,t=[]){const n=Object.assign({},e);for(const r of t)r in n&&delete n[r];return n}var c=(0,r.G)((function(e,t){const{fallbackSrc:n,fallback:r,src:c,srcSet:d,align:h,fit:g,loading:u,ignoreFallback:p,crossOrigin:f,fallbackStrategy:x="beforeLoadOrError",referrerPolicy:y,...m}=e,j=null!=u||p||!(void 0!==n||void 0!==r),w=(0,i.d)({...e,crossOrigin:f,ignoreFallback:j}),v=(0,i.z)(w,x),A={ref:t,objectFit:g,objectPosition:h,...j?m:l(m,["onError","onLoad"])};return v?r||(0,a.jsx)(s.m.img,{as:o,className:"chakra-image__placeholder",src:n,...A}):(0,a.jsx)(s.m.img,{as:o,src:c,srcSet:d,crossOrigin:f,loading:u,referrerPolicy:y,className:"chakra-image",...A})}));c.displayName="Image"},7471:function(e,t,n){"use strict";n.d(t,{aV:function(){return f},DE:function(){return m},HC:function(){return y},QI:function(){return x}});var r=n(5059),a=n(1639),o=n(5425),i=n(5432),s=n(5893),l={path:(0,s.jsxs)("g",{stroke:"currentColor",strokeWidth:"1.5",children:[(0,s.jsx)("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),(0,s.jsx)("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),(0,s.jsx)("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},c=(0,r.G)(((e,t)=>{const{as:n,viewBox:r,color:c="currentColor",focusable:d=!1,children:h,className:g,__css:u,...p}=e,f={ref:t,focusable:d,className:(0,i.cx)("chakra-icon",g),__css:{w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:c,...u,...(0,a.mq)("Icon",e)}},x=null!=r?r:l.viewBox;if(n&&"string"!==typeof n)return(0,s.jsx)(o.m.svg,{as:n,...f,...p});const y=null!=h?h:l.path;return(0,s.jsx)(o.m.svg,{verticalAlign:"middle",viewBox:x,...f,...p,children:y})}));c.displayName="Icon";var d=n(5227),h=n(2495),g=n(3179),[u,p]=(0,d.k)({name:"ListStylesContext",errorMessage:"useListStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<List />\" "}),f=(0,r.G)((function(e,t){const n=(0,a.jC)("List",e),{children:r,styleType:i="none",stylePosition:l,spacing:c,...d}=(0,g.Lr)(e),p=(0,h.W)(r),f=c?{"& > *:not(style) ~ *:not(style)":{mt:c}}:{};return(0,s.jsx)(u,{value:n,children:(0,s.jsx)(o.m.ul,{ref:t,listStyleType:i,listStylePosition:l,role:"list",__css:{...n.container,...f},...d,children:p})})}));f.displayName="List",(0,r.G)(((e,t)=>{const{as:n,...r}=e;return(0,s.jsx)(f,{ref:t,as:"ol",styleType:"decimal",marginStart:"1em",...r})})).displayName="OrderedList";var x=(0,r.G)((function(e,t){const{as:n,...r}=e;return(0,s.jsx)(f,{ref:t,as:"ul",styleType:"initial",marginStart:"1em",...r})}));x.displayName="UnorderedList";var y=(0,r.G)((function(e,t){const n=p();return(0,s.jsx)(o.m.li,{ref:t,...e,__css:n.item})}));y.displayName="ListItem";var m=(0,r.G)((function(e,t){const n=p();return(0,s.jsx)(c,{ref:t,role:"presentation",...e,__css:n.icon})}));m.displayName="ListIcon"}},function(e){e.O(0,[672,637,774,888,179],(function(){return t=9260,e(e.s=t);var t}));var t=e.O();_N_E=t}]);